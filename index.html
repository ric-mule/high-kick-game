<!-- Fat Mule Checkout (fully sandboxed / no global styles) -->
<div class="fm-checkout" id="fm-checkout" data-logo="">
  <style>
    /* ------- SCOPE EVERYTHING TO .fm-checkout ------- */
    .fm-checkout{font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:#e6edf7}
    .fm-checkout *{box-sizing:border-box}
    .fm-card{background:#0f1732;border:1px solid #1e2a4a;border-radius:12px;padding:16px}
    .fm-row{display:grid;gap:12px}
    .fm-grid{display:grid;grid-template-columns:1.2fr 1fr;gap:16px}
    @media (max-width:900px){.fm-grid{grid-template-columns:1fr}}

    .fm-header{display:flex;align-items:center;gap:10px;margin-bottom:10px}
    .fm-logo{width:40px;height:40px;border-radius:8px;background:#0b1431 center/contain no-repeat;border:1px solid #24335c}
    .fm-title{font-weight:700}
    .fm-muted{color:#9fb0cc}

    .fm-label{font-weight:600;margin:6px 0}
    .fm-input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #25335c;background:#0b1431;color:#e8f0ff}
    .fm-row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}

    .fm-check{display:grid;grid-template-columns:auto 1fr;gap:10px;align-items:start;padding:10px;border:1px solid #1b284f;border-radius:10px;background:#0b1431}
    .fm-check input{margin-top:2px;transform:scale(1.05)}
    .fm-note{font-size:12px;color:#95a7c9;margin-top:2px}

    .fm-preview{display:flex;align-items:center;gap:10px;padding:12px;border:1px dashed #2a3a6d;border-radius:10px;background:#0c1635}
    .fm-chip{width:34px;height:22px;border-radius:5px;background:linear-gradient(90deg,#ffe29a,#ffd36b);box-shadow:inset 0 0 0 1px rgba(0,0,0,.25)}

    .fm-actions{display:flex;gap:8px;margin-top:6px;flex-wrap:wrap}
    .fm-btn{cursor:pointer;border:0;border-radius:10px;padding:10px 14px;font-weight:700;background:linear-gradient(180deg,#34d399,#10b981);color:#062312}
    .fm-btn.secondary{background:#0e1733;color:#c6d3f5;border:1px solid #25335c}
    .fm-small{font-size:12px;color:#9fb0cc;margin-top:6px}
  </style>

  <div class="fm-card">
    <div class="fm-header">
      <div class="fm-logo" id="fm-logo" aria-hidden="true"></div>
      <div>
        <div class="fm-title">Fat Mule Checkout</div>
        <div class="fm-muted">Load your card, then jump into the game.</div>
      </div>
    </div>

    <div class="fm-grid">
      <!-- Contact / Billing -->
      <div class="fm-row">
        <label class="fm-label" for="fm-email">Email</label>
        <input class="fm-input" id="fm-email" type="email" placeholder="you@domain.com" autocomplete="email"/>

        <!-- as requested: directly under Email -->
        <label class="fm-check">
          <input id="fm-future-email" type="checkbox"/>
          <span>
            Send me reminders before future games
            <div class="fm-note">Only game reminders & receipts. Unsubscribe anytime.</div>
          </span>
        </label>

        <div class="fm-row2">
          <div>
            <label class="fm-label" for="fm-first">First name</label>
            <input class="fm-input" id="fm-first" type="text" autocomplete="given-name"/>
          </div>
          <div>
            <label class="fm-label" for="fm-last">Last name</label>
            <input class="fm-input" id="fm-last" type="text" autocomplete="family-name"/>
          </div>
        </div>

        <div class="fm-row2">
          <div>
            <label class="fm-label" for="fm-phone">Phone (optional)</label>
            <input class="fm-input" id="fm-phone" type="tel" autocomplete="tel" placeholder="(555) 123-4567"/>
          </div>
          <div>
            <label class="fm-label" for="fm-zip">ZIP</label>
            <input class="fm-input" id="fm-zip" type="text" inputmode="numeric" autocomplete="postal-code"/>
          </div>
        </div>
      </div>

      <!-- Card -->
      <div class="fm-row">
        <div class="fm-preview" aria-live="polite">
          <div class="fm-chip"></div>
          <div>
            <div class="fm-muted">Card preview</div>
            <strong id="fm-card-label">•••• •••• •••• 4242</strong>
          </div>
        </div>

        <!-- as requested: right under card preview -->
        <label class="fm-check">
          <input id="fm-save-remind" type="checkbox"/>
          <span>
            Save this card and remind me of future games
            <div class="fm-note">Store card securely for faster checkout and reminders.</div>
          </span>
        </label>

        <div class="fm-row2">
          <div>
            <label class="fm-label" for="fm-cc">Card number</label>
            <input class="fm-input" id="fm-cc" type="text" inputmode="numeric" placeholder="4242 4242 4242 4242"/>
          </div>
          <div>
            <label class="fm-label" for="fm-exp">Expiry</label>
            <input class="fm-input" id="fm-exp" type="text" inputmode="numeric" placeholder="MM/YY"/>
          </div>
        </div>

        <div class="fm-row2">
          <div>
            <label class="fm-label" for="fm-cvc">CVC</label>
            <input class="fm-input" id="fm-cvc" type="text" inputmode="numeric" placeholder="CVC"/>
          </div>
          <div>
            <label class="fm-label" for="fm-name">Name on card</label>
            <input class="fm-input" id="fm-name" type="text" placeholder="Full name"/>
          </div>
        </div>

        <div class="fm-actions">
          <button class="fm-btn" id="fm-submit">Send &amp; Continue</button>
          <button class="fm-btn secondary" type="button" id="fm-cancel">Cancel</button>
        </div>
        <div class="fm-small">By continuing, you agree to Fat Mule’s Terms and Privacy Policy.</div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const root   = document.currentScript.closest('.fm-checkout');
      const logoEl = root.querySelector('#fm-logo');
      const num    = root.querySelector('#fm-cc');
      const label  = root.querySelector('#fm-card-label');

      // Optional inline logo: set data-logo="data:image/png;base64,..." on the container.
      const uri = root.getAttribute('data-logo');
      if (uri) logoEl.style.backgroundImage = `url("${uri}")`;

      // Mirror last 4 digits into preview (local only)
      num.addEventListener('input', ()=>{
        const digits = (num.value || '').replace(/\D/g,'').slice(-4);
        label.textContent = digits ? `•••• •••• •••• ${digits}` : '•••• •••• •••• 4242';
      });

      // Dispatch custom events instead of navigating (so your builder controls flow)
      root.querySelector('#fm-submit').addEventListener('click', (e)=>{
        e.preventDefault();
        const detail = {
          email: root.querySelector('#fm-email').value,
          first: root.querySelector('#fm-first').value,
          last : root.querySelector('#fm-last').value,
          phone: root.querySelector('#fm-phone').value,
          zip  : root.querySelector('#fm-zip').value,
          cc   : root.querySelector('#fm-cc').value,
          exp  : root.querySelector('#fm-exp').value,
          cvc  : root.querySelector('#fm-cvc').value,
          name : root.querySelector('#fm-name').value,
          futureEmail: root.querySelector('#fm-future-email').checked,
          saveCardRemind: root.querySelector('#fm-save-remind').checked
        };
        root.dispatchEvent(new CustomEvent('fm:checkoutSubmit',{bubbles:true,detail}));
      });

      root.querySelector('#fm-cancel').addEventListener('click', (e)=>{
        e.preventDefault();
        root.dispatchEvent(new CustomEvent('fm:checkoutCancel',{bubbles:true}));
      });
    })();
  </script>
</div>
